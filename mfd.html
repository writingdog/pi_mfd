<!DOCTYPE html>
<!-- saved from url=(0044)https://www.writing.dog/experiments/mfd.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
        <title>WebSocket demo</title>
        <script src="./scripts/jquery-3.2.1.min.js"></script>
    	<style type="text/css">
    		body {
    			border: 0em;
    			padding: 0em;
    			background-color: #000000;
    			box-sizing: border-box;
    			font-family: monospace;
    			font-weight: bold;
				font-size: 12pt;
    		}				
    		div {
    			box-sizing: border-box;
    		}
    		span {
    			box-sizing: border-box;
    		}
			.main_container {
				border: 0em;
				padding: 0em;
				position: absolute;
				left: 0em;
				right: 0em;
				top: 0em;
				bottom: 0em;
				width: 100%;
				height: 100%;
				background-color: #000000;
				display: block;
				overflow:hidden;
			}
    		.osb_on,.osb_off,.osb_sel,.osb_corner_off,.osb_corner_on,.osb_corner_sel {
    			color: #33cc33;
    			text-align: center;
    			display: flex;
    			position: relative;
    			flex-flow: row nowrap;
    		}
    		.osb_on,.osb_off,.osb_sel {
    			width: 116px;
    		}
    		.osb_corner_off,.osb_corner_on,.osb_corner_sel {
    			width: 110px;
    		}
    		.osb_off span, .osb_corner_off span {
    			border: .1em solid #000000;
    			color: #33cc33;
    			background-color: #000000;
    		}
    		.osb_on span, .osb_corner_on span {
    			border: .1em solid #33cc33;
    			color: #33cc33;
    			background-color: #000000;
    		}
    		.osb_sel span, .osb_corner_sel span {
    			border: .1em solid #e6ffe6;
    			background-color: #e6ffe6;
    			color: #000000;
    		}
    		.osb_bottom,.osb_top {
    			display: block;
    			width: 80%;
    			margin-left: 10%;
    			height: auto;
    			line-height: auto;
    			position: absolute;
    		}
    		.osb_bottom {
    			bottom: 33%;
    		}
    		.osb_top {
    			top: 33%;
    		}
    		.osb_left,.osb_right {
    			display: inline-block;
    			width: 80%;
    			margin-left: 10%;
    			height: 1.5em;
    			line-height: 1.5em;
    			margin-top: 37%;
    		}
    		.mfd_left {
    			position: absolute;
    			left: 0px;
    			top: 0px;
    			width: 800px;
    			height: 800px;
				transform: scale(0.7);
				transform-origin: 0% 0%;
    		}
			.mfd_right {
				position: absolute;
				right: 0px;
				top: 0px;
				width: 800px;
				height: 800px;
				transform: scale(0.7);
				transform-origin: 100% 0%;
			}
    		.mfd_table {
    			border: 0em;
    			padding: 0em;
    			width: 100%;
    			height: 100%;
    			display: flex;
    			flex-flow: column nowrap;
    			flex: 1 1 auto;
    		}
    		.mfd_row_l,.mfd_row_u {
    			display: flex;
    			width: 100%;
    			flex-flow: row nowrap;
    			height: 110px;
    		}
    		.mfd_row_n {
    			display: flex;
    			width: 100%;
    			flex-flow: row nowrap;    
    			height: 116px;		
    		}
    		.mfd_table tr,.mft_table td {
    			border: 0em;
    			padding: 0em;
    		}
    		.mfd_center {
    			flex-flow: column nowrap;
    			flex: 5 5 auto;
    		}
    		.mfd_center_display {
    			position: absolute;
    			left: 110px;
    			top: 110px;
    			height: 580px;
    			width: 580px;
				overflow: hidden;
    		}
			.mfd_center_text {
				color: #33cc33;
				margin-top: 80px;
				margin-left: 80px;
			}
			.error_message {
				width: 440px;
				display: inline-block;
				color: #ffffff;
				font-weight: 100;
				border: .1em solid #ffffff;
				background-color: #e60000;
				padding-left: .5em;
				padding-right: .5em;
			}
    		
    	</style>
    	<script type="text/javascript">
			var mfd_count = 0;
			/*
    	    var mode = 0; // 0 = normal, 1 = profile select
    		var ws = new WebSocket("ws://192.168.2.25:5678/");
			var mfd_side = "left";
			ws.onopen = function() {
				ws.send("open_ok");
				update_central_display("Connection established.<br />",true);
			}
            ws.onmessage = function (event) {
				var estr = event.data;
				var ep = estr.split(",")
				if(ep[0]=="osb") {
					update_osb_display(ep[1],parseInt(ep[2]));
				}
				else if(ep[0]=="txt") {
					update_osb_text(ep[1],ep[3])
					update_osb_display(ep[1],parseInt(ep[2]));
				}
				else if(ep[0]=="ctxt") {
					update_central_display(ep[3])
				}
				else if(ep[0]=="ctxt_a") {
					update_central_display(ep[3],true)
				}
				else if(ep[0]=="ctxt_e") {
					update_central_display(ep[3],true,true) // Specify it should be displayed as an error.
				}
				else if(ep[0]=="side") {
					if(ep[1]=="right") {
						mfd_side = "right";
					}
					else {
						mfd_side = "left";
					}
					$("#mfd_main_container").removeClass();
					$("#mfd_main_container").addClass("mfd_"+mfd_side)
				}
				else {
					console.log(ep)
				}
				//ws.send("message OK");
            };
			*/
            
			class mfd {
				constructor(ip,side,pos_x,pos_y,scale_x,scale_y) {
					this.ip = ip;
					this.side = side;
					this.mfd_id = parseInt(mfd_count);
					this.main_id = "mfd_"+this.mfd_id+"_main_container";
					this.osb_prefix = "#osb_"+this.mfd_id+"_";
					this.osb_text_prefix = "#osb_"+this.mfd_id+"_text_";
					this.text_id = "#mfd_"+this.mfd_id+"_center_text";
					this.mode = 0; // 0 is normal, 1 is profile select
					this.ws;
					this.scale_x = scale_x;
					this.scale_y = scale_y;
					this.scale_x_original = scale_x;
					this.scale_y_original = scale_y;
					this.pos_x = pos_x;
					this.pos_y = pos_y;
					this.pos_x_original = pos_x;
					this.pos_y_original = pos_y;
					mfd_count++;
				}
				add_mfd_object() {
					var mfd_container = $("<div />",{"id":this.main_id});
					if(this.side=="right") {
						$(mfd_container).addClass("mfd_right");
						$(mfd_container).css({"right":this.pos_x_original});
					}
					else {
						$(mfd_container).addClass("mfd_left");
						$(mfd_container).css({"left":this.pos_x_original});
					}
					$(mfd_container).css({"top":this.pos_y_original,"transform":"scale("+this.scale_x+","+this.scale_y+")"})
					var prefix = "osb_"+this.mfd_id+"_";
					var mfd_table = $("<div />",{"class":"mfd_table"});

					// Create the top row

					var mfd_row_u = $("<div />",{"class":"mfd_row_u"});
					$(mfd_row_u).append($("<div />",{"class":"osb_corner_off","id":prefix+"a"}));
					for(var i=1;i<=5;i++) {
						var osb_container = $("<div />",{"class":"osb_off","id":prefix+""+i});
						$(osb_container).append($("<span />",{"class":"osb_top","id":prefix+"text_"+i,"text":i}));
						$(mfd_row_u).append(osb_container);
					}
					$(mfd_row_u).append($("<div />",{"class":"osb_corner_off","id":prefix+"b"}));
					$(mfd_table).append(mfd_row_u);

					// Now append the first middle row that also includes the center display...

					var mfd_row_t = $("<div />",{"class":"mfd_row_n"});
					var mfd_id_20 = $("<div />",{"class":"osb_off","id":prefix+"20"});
					$(mfd_id_20).append($("<span />",{"class":"osb_left","id":prefix+"text_20","text":"20"}));
					var mfd_center = $("<div />",{"class":"mfd_center_display","id":prefix+"display"});
					var mfd_center_text = $("<div />",{"class":"mfd_center_text","id":"mfd_"+this.mfd_id+"_center_text","html":"Startup...<br />"});
					$(mfd_center).append(mfd_center_text);
					var mfd_id_6 = $("<div />",{"class":"osb_off","id":prefix+"6"});
					$(mfd_id_6).append($("<span />",{"class":"osb_right","id":prefix+"text_6","text":"6"}));
					$(mfd_row_t).append(mfd_id_20);
					$(mfd_row_t).append(mfd_center);
					$(mfd_row_t).append($("<div />",{"class":"mfd_center"}));
					$(mfd_row_t).append(mfd_id_6);

					$(mfd_table).append(mfd_row_t);

					// Now the rest of the left / right buttons

					for(var i=1;i<=4;i++) {
						var mfd_row = $("<div />",{"class":"mfd_row_n"});
						var osb_l_container = $("<div />",{"class":"osb_off","id":prefix+""+(20-i)});
						$(osb_l_container).append($("<span />",{"class":"osb_left","id":prefix+"text_"+(20-i),"text":(20-i)}));
						var osb_r_container = $("<div />",{"class":"osb_off","id":prefix+""+(6+i)});
						$(osb_r_container).append($("<span />",{"class":"osb_right","id":prefix+"text_"+(6+i),"text":(6+i)}));
						$(mfd_row).append(osb_l_container);
						$(mfd_row).append($("<div />",{"class":"mfd_center"}));
						$(mfd_row).append(osb_r_container);
						$(mfd_table).append(mfd_row);
					}

					// Now the bottom row

					var mfd_row_l = $("<div />",{"class":"mfd_row_l"});
					$(mfd_row_l).append($("<div />",{"class":"osb_corner_off","id":prefix+"d"}));
					for(var i=1;i<=5;i++) {
						var osb_container = $("<div />",{"class":"osb_off","id":prefix+""+(16-i)});
						$(osb_container).append($("<span />",{"class":"osb_top","id":prefix+"text_"+(16-i),"text":(16-i)}));
						$(mfd_row_l).append(osb_container);
					}
					$(mfd_row_l).append($("<div />",{"class":"osb_corner_off","id":prefix+"c"}));
					$(mfd_table).append(mfd_row_l);

					// Now add to the MFD container and the main page.

					$(mfd_container).append(mfd_table);
					$("#main_container").append(mfd_container);
				}

				change_mfd_side(side) {
					this.side = side;
					$(this.main_id).removeClass();
					if(side=="right") {
						$(this.main_id).addClass("mfd_right");
					}
					else {
						$(this.main_id).addClass("mfd_left");
					}
				}

				reset_mfd_size() {
					this.scale_x = parseFloat(this.scale_x_original);
					this.scale_y = parseFloat(this.scale_y_original);
					$("#"+this.main_id).css({"transform":"scale("+this.scale_x+","+this.scale_y+")"});
				}

				set_mfd_size(scale_x, scale_y) {
					this.scale_x = scale_x;
					if(scale_y!=undefined) {
						// In this case, we will not scale the X and Y of the MFD by different amounts.
						this.scale_y = scale_y;
					}
					$("#"+this.main_id).css({"transform":"scale("+this.scale_x+","+this.scale_y+")"});
				}

				change_mfd_size(dir, val) {
					// Increments or decrements the MFD scaling.
					if(dir=="x") {
						this.scale_x = this.scale_x + parseFloat(val);
					}
					else if(dir=="y") {
						this.scale_y = this.scale_y + parseFloat(val);
					}
					$("#"+this.main_id).css({"transform":"scale("+this.scale_x+","+this.scale_y+")"});
				}

				reset_mfd_pos() {
					this.pos_x = parseFloat(this.pos_x_original);
					this.pos_y = parseFloat(this.pos_y_original);
					if(this.side=="right") {
						$("#"+this.main_id).css({"top":this.pos_y,"right":this.pos_x});
					}
					else {
						$("#"+this.main_id).css({"top":this.pos_y,"left":this.pos_x});
					}
				}

				change_mfd_pos(dir,val) {
					if(dir=="x") {
						this.pos_x = this.pos_x + parseFloat(val);
					}
					else if(dir=="y") {
						this.pos_y = this.pos_y + parseFloat(val);
					}
					if(this.side=="right") {
						$("#"+this.main_id).css({"top":this.pos_y,"right":this.pos_x});
					}
					else {
						$("#"+this.main_id).css({"top":this.pos_y,"left":this.pos_x});
					}
				}

				link() {
					this.ws = new WebSocket("ws://"+this.ip);
					var mfd = this;
					this.ws.onopen = function() {
						mfd.ws.send("open ok");
						mfd.update_center_text("Connection established.<br />",true);
					}
					this.ws.onmessage = function(event) {
						var estr = event.data;
						var ep = estr.split(",");
						if(ep[0]=="osb") {
							mfd.update_osb_display(ep[1],parseInt(ep[2]));
						}
						else if(ep[0]=="txt") {
							mfd.update_osb_text(ep[1],ep[3])
							mfd.update_osb_display(ep[1],parseInt(ep[2]));
						}
						else if(ep[0]=="ctxt") {
							mfd.update_center_text(ep[3])
						}
						else if(ep[0]=="ctxt_a") {
							mfd.update_center_text(ep[3],true)
						}
						else if(ep[0]=="ctxt_e") {
							mfd.update_center_text(ep[3],true,true) // Specify it should be displayed as an error.
						}
						else if(ep[0]=="side") {
							mfd.change_mfd_side(ep[1]);
						}
						else if(ep[0]=="size") {
							if(ep[1]=="r") {
								// Size reset command received
								mfd.reset_mfd_size();
							}
							else {
								// Adjust the scaling in direction x/y by the value in ep[2]
								mfd.change_mfd_size(ep[1],ep[2]);
							}
						}
						else if(ep[0]=="pos") {
							if(ep[1]=="r") {
								// Position reset command received
								mfd.reset_mfd_pos();
							}
							else {
								// Adjust the position in direction x/y by the value in ep[2]
								mfd.change_mfd_pos(ep[1],ep[2]);
							}
						}
						else {
							console.log(ep)
						}
					}
				}

				update_center_text(txt,a,err) {
					// "a" means "append"
					if(a==undefined) {
						a=false;
					}
					if(err==undefined) {
						err=false;
					}
					if(a==true) {
						$(this.text_id).append("<br />");
						$(this.text_id).append(txt);
					}
					else {
						$(this.text_id).empty();
						if(err==true) {
							var msg = $("<span />",{"class":"error_message","text":txt});
							$(this.text_id).append(msg);
						}
						else {
							$(this.text_id).html(txt);
						}
					}
				};

				update_osb_display(idx,v) {
					// Turn the OSB on, turn it off, or highlight it

					var osb_id = this.osb_prefix + "" + idx;
					$(osb_id).removeClass();
					if(v==1) {
						// This means the OSB should be shown as highlighted permanently
						if(parseInt(idx)==idx) {
							// So it's one of the OSB buttons
							$(osb_id).addClass("osb_sel");
						}
						else {
							// So it's a corner button
							$(osb_id).addClass("osb_corner_sel")
						}
					}
					else if(v==0) {
						// This means the OSB should be outlined but not highlighted
						if(parseInt(idx)==idx) {
							// One of the OSB buttons
	            		    $(osb_id).addClass("osb_on")
						}
						else {
							// Corner button
							$(osb_id).addClass("osb_corner_on")
						}
					}
					else {
						// Switch OSB highlighting etc. off
						if(parseInt(idx)==idx) {
							$(osb_id).addClass("osb_off")
						}
						else {
							$(osb_id).addClass("osb_corner_off")
						}		
					}
				}

				update_osb_text(idx,t) {
					var osb_id = this.osb_text_prefix + "" + idx;
					$(osb_id).empty();
					$(osb_id).html(t);
				}


			}

			function setup() {
				//$("#mfd_main_container").removeClass();
				//$("#mfd_main_container").addClass("mfd_"+mfd_side);
				//update_central_display("Setup scripts finished...<br />",true);
				mfd_main = new mfd("192.168.2.24:5678","left");
				mfd_main.add_mfd_object();
				mfd_main.link();

				//mfd_right = new mfd("192.168.2.25:5678","right");
				//mfd_right.add_mfd_object();
				//mfd_right.link();
			}
    	</script>
    </head>
    <body onload="setup()">
		<div id="main_container" class="main_container">

		</div>
		<!--
    	<div id="mfd_main_container" class="mfd_left">
    		<div class="mfd_table">
    			<div class="mfd_row_u">
    				<div class="osb_corner_off" id="osb_a"></div>
    				<div class="osb_off" id="osb_1"><span class="osb_top" id="osb_text_1">1</span></div>
    				<div class="osb_off" id="osb_2"><span class="osb_top" id="osb_text_2">2</span></div>
    				<div class="osb_off" id="osb_3"><span class="osb_top" id="osb_text_3">3<br>3B</span></div>
    				<div class="osb_off" id="osb_4"><span class="osb_top" id="osb_text_4">4</span></div>
    				<div class="osb_off" id="osb_5"><span class="osb_top" id="osb_text_5">5</span></div>
    				<div class="osb_corner_off" id="osb_b"></div>
    			</div>
    			<div class="mfd_row_n">
    				<div class="osb_off" id="osb_20"><span class="osb_left" id="osb_text_20">20</span></div>
    				<div class="mfd_center_display" id="mfd_display">
						<div class="mfd_center_text" id="mfd_center_text">
							Startup...<br />
						</div>
					</div>
    				<div class="mfd_center"></div>
    				<div class="osb_off" id="osb_6"><span class="osb_right" id="osb_text_6">6</span></div>
    			</div>
    			<div class="mfd_row_n">
    				<div class="osb_off" id="osb_19"><span class="osb_left" id="osb_text_19">19</span></div>
    				<div class="mfd_center"></div>
    				<div class="osb_off" id="osb_7"><span class="osb_right" id="osb_text_7">7</span></div>
    			</div>
    			<div class="mfd_row_n">
    				<div class="osb_off" id="osb_18"><span class="osb_left" id="osb_text_18">18</span></div>
    				<div class="mfd_center"></div>
    				<div class="osb_off" id="osb_8"><span class="osb_right" id="osb_text_8">8</span></div>
    			</div>
    			<div class="mfd_row_n">
    				<div class="osb_off" id="osb_17"><span class="osb_left" id="osb_text_17">17</span></div>
    				<div class="mfd_center"></div>
    				<div class="osb_off" id="osb_9"><span class="osb_right" id="osb_text_9">9</span></div>
    			</div>
    			<div class="mfd_row_n">
    				<div class="osb_off" id="osb_16"><span class="osb_left" id="osb_text_16">16</span></div>
    				<div class="mfd_center"></div>
    				<div class="osb_off" id="osb_10"><span class="osb_right" id="osb_text_10">10</span></div>
    			</div>
    			<div class="mfd_row_l">
    				<div class="osb_corner_off" id="osb_d"></div>
    				<div class="osb_off" id="osb_15"><span class="osb_bottom" id="osb_text_15">15</span></div>
    				<div class="osb_off" id="osb_14"><span class="osb_bottom" id="osb_text_14">14</span></div>
    				<div class="osb_off" id="osb_13"><span class="osb_bottom" id="osb_text_13">13<br>13B</span></div>
    				<div class="osb_off" id="osb_12"><span class="osb_bottom" id="osb_text_12">12</span></div>
    				<div class="osb_off" id="osb_11"><span class="osb_bottom" id="osb_text_11">11</span></div>
    				<div class="osb_corner_off" id="osb_c"></div>
    			</div>
    		</div>
    	
    	</div>
	-->
    
</body></html>